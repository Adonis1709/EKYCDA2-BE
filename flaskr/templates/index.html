<!doctype html>
<html ng-app="EKYCDA2">

<head>
  <title>EKYCDA2</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="icon" type="image/x-icon" href="favicon.ico"> -->
  <!-- <link rel="preconnect" href="https://fonts.gstatic.com"> -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
  <!-- <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.2.5/angular-material.min.css"
    integrity="sha512-SudEgtLVV+Wip7/PrEh2zd0mO/PqR1w26NEJfhnHGxZdng3KYsLhpAZQG0mPMUykCYoKgdBc7/ItrUYzbC0aTw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.css"> -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="static/style.css">
  <!-- <nav>
</nav> -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.js"></script>
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular.min.js"></script> -->
</head>

<body>
  <div class="loading animate-show-hide" id="loading-root"></div>
  <div class="root-container" style="overflow: overlay;">
    <div ng-view></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/1.0.30/angular-ui-router.min.js"
    integrity="sha512-HdDqpFK+5KwK5gZTuViiNt6aw/dBc3d0pUArax73z0fYN8UXiSozGNTo3MFx4pwbBPldf5gaMUq/EqposBQyWQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-animate.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-aria.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-messages.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-animate.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bs-stepper/dist/js/bs-stepper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-route/1.8.3/angular-route.min.js"
    integrity="sha512-y1qD3hz/IAf8W4+/UMLZ+CN6LIoUGi7srWJ3r1R17Hid8x0yXe+1B5ZelkaL1Mjzedzu0Cg3HBvDG02SAgSzBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Angular Material Library -->
  <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.js"></script>


  <!-- Bootstrap -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

  <!-- controller page -->
  <script src="/static/js/index.js"></script>
  <script src="/static/js/home.js"></script>
  <script src="/static/js/login.js"></script>
  <script src="/static/js/register.js"></script>
  <script src="/static/js/verify-email.js"></script>
  <script src="/static/js/verify-account.js"></script>
  <script src="/static/js/process-verify-account.js"></script>
  <script src="/static/js/verify-account-process.js"></script>
  <script src="/static/js/confirm-info.js"></script>
  <script src="/static/js/faceid.js"></script>
  <script src="/static/js/faceid-process.js"></script>
  <script src="/static/js/faceid-success.js"></script>

  <script src="/static/js/transfer-history.js"></script>
  <script src="/static/js/top-up.js"></script>
  <script src="/static/js/profile.js"></script>
  <script src="/static/js/withdraw.js"></script>
  <script src="/static/js/transfer.js"></script>

  <script src="/static/js/change-password.js"></script>
  <script src="/static/js/reset-password.js"></script>

  <script src="/static/js/404.js"></script>


  <!-- controller component -->
  <script src="/static/js/component/navigate.js"></script>

  <script src="/static/js/service/index.js"></script>
  <script src="https://rawgit.com/moment/moment/2.2.1/min/moment.min.js"></script>

  <script>
    const app = angular.module("EKYCDA2", ["ngRoute", "ngMaterial", "ngMessages", "ngAnimate"]);
    const loadingRoot = document.getElementById("loading-root");
    app.service('Api', Api);

    app.filter('range', function () {
      return function (input, total) {
        total = parseInt(total);

        for (var i = 0; i < total; i++) {
          input.push(i);
        }

        return input;
      };
    });
    app.component('navigate', {
      template: `<div>
<nav class=" navbar navbar-expand-lg navbar-dark bg-dark" style="padding: 0 0; display:block;" >
        <div class="navbar navbar-expand-lg navbar-dark bg-dark">
            <a class="navbar-brand" href="#!/">WALLET</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto" style="flex: 1;">
                    <li class="nav-item active">
                        <a class="nav-link" href="#!/">Home<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#!/top-up">Top up</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="#!/transfer">Transfer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="#!/withdraw">Withdraw</a>
                    </li>
                </ul>
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="" id="navbarDropdown" role="button"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {{fullname}}
                            <img src="static/images/setting.jpg" style="height: 30px; width: 30px;" />
                        </a>
                        <div class="dropdown-menu" style="left: unset; right: 0;" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="#!/profile">Profile</a>
                            <a class="dropdown-item" href="#!/change-password">Change password</a>
                            <a class="dropdown-item" href="#!/transfer-history">Transfer history</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#!/login">Logout</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
</div>
</nav>
</div>`,
      controller: function ($scope, Api) {
        NavigateController($scope, Api)
      }
    });



    app.controller("home-controller", ["$scope", "$location", "Api", function ($scope, $location, Api) {
      HomeController($scope, $location, Api)
    }])
    app.controller("login-controller", ["$scope", "$location", "Api", function ($scope, $location, Api) {
      LoginController($scope, $location, Api)
    }])
    app.controller("register-controller", ["$scope", "$location", "Api", function ($scope, $location, Api) {
      RegisterController($scope, $location, Api)
    }])
    app.controller("verify-email-controller", ["$scope", "$location", "Api", "$interval", function ($scope, $location, Api, $interval) {
      VerifyEmailController($scope, $location, Api, $interval)
    }])
    app.controller("verify-account-controller", ["$scope", "$location", "Api", function ($scope, $location, Api) {
      VerifyAccountController($scope, $location, Api)
    }])
    app.controller("process-verify-account-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      ProcessVerifyAccountController($scope, $location, Api, $element)
    }])
    app.controller("confirm-info-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      ConfirmInfoController($scope, $location, Api, $element)
    }])
    app.controller("verify-account-process-controller", ["$scope", "$location", "$element", "$timeout", "Api", function ($scope, $location, $element, $timeout, Api) {
      VerifyAccountProcessController($scope, $location, $element, $timeout, Api)
    }])
    app.controller("faceid-controller", ["$scope", "$location", "Api", "$element", "$interval", function ($scope, $location, Api, $element, $interval) {
      FaceidController($scope, $location, Api, $element, $interval)
    }])
    app.controller("faceid-process-controller", ["$scope", "$location", "Api", "$element", "$timeout", function ($scope, $location, Api, $element, $timeout) {
      FaceidProcessController($scope, $location, Api, $element, $timeout)
    }])
    app.controller("faceid-success-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      FaceidSuccessController($scope, $location, Api, $element)
    }])


    app.controller("transfer-history-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      TransferHistoryController($scope, $location, Api, $element)
    }])
    app.controller("profile-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      ProfileController($scope, $location, Api, $element)
    }])
    app.controller("topup-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      TopupController($scope, $location, Api, $element)
    }])
    app.controller("transfer-controller", ["$scope", "$location", "Api", "$element", "$q", "$timeout", function ($scope, $location, Api, $element, $q, $timeout) {
      TransferController($scope, $location, Api, $element, $q, $timeout)
    }])
    app.controller("withdraw-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      WithdrawController($scope, $location, Api, $element)
    }])


    app.controller("change-password-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      ChangePasswordController($scope, $location, Api, $element)
    }])
    app.controller("reset-password-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      ResetPasswordController($scope, $location, Api, $element)
    }])

    app.controller("404-controller", ["$scope", "$location", "Api", "$element", function ($scope, $location, Api, $element) {
      FNF404Controller($scope, $location, Api, $element)
    }])
    function route() {
      loadingRoot.classList.remove("ng-hide")
    }
    function authenticate($location, Api) {
      loadingRoot.classList.remove("ng-hide")
      const status = Api.user.status;
      const path = $location.$$path;
      const token = $location.$$search?.token;
      if (Api?.user?.isLogin || token) {
        if (status == STATUS_ACCOUNT.done || token) {
          //"/faceid-success" not care
          if (["/faceid-process", "/faceid", "/confirm-info", "/verify-account-process",
            "/verify-account/lisence", "/verify-account/passport", "/verify-account/cmnd",
            "/verify-account", "/verify-email"].includes(path)) {
            $location.path("/")
            $scope.$apply()
          } else {
            //accept route
          }
        } else if (status == STATUS_ACCOUNT.verify_email) {
          if (path !== "/verify-email") {
            $location.path("/verify-email")
            $scope.$apply()
          }
        } else if (status == STATUS_ACCOUNT.verify_process_email) {
          //do nothing
          if (path !== "/verify-email") {
            $location.path("/verify-email")
            $scope.$apply()
          }
        } else if (status == STATUS_ACCOUNT.verify_card) { // 4 object match
          if (!path.includes("/verify-account")) {
            $location.path("/verify-account")
            $scope.$apply()
          }
        } else if (status == STATUS_ACCOUNT.verify_process_card) {
          //do nothing
          if (path !== "/verify-account-process") {
            $location.path("/verify-account-process")
            $scope.$apply()
          }
        } else if (status == STATUS_ACCOUNT.verify_profile) {
          if (path !== "/confirm-info") {
            $location.path("/confirm-info")
            $scope.$apply()
          }
        } else if (status == STATUS_ACCOUNT.verify_process_profile) {
          //do nothing
          if (path !== "/verify-account-process") {
            $location.path("/verify-account-process")
            $scope.$apply()
          }
        } else if (status == STATUS_ACCOUNT.verify_face) {
          if (path !== "/faceid" && path !== "") {
            $location.path("/faceid")
            $scope.$apply()
          }
        } else if (status == STATUS_ACCOUNT.verify_process_face) {
          //do nothing
          if (path !== "/faceid-process") {
            $location.path("/faceid-process")
            $scope.$apply()
          }
        } else if (status == STATUS_ACCOUNT.verify_process_face) {
          //do nothing
          if (path !== "/faceid-process") {
            $location.path("/faceid-process")
            $scope.$apply()
          }
        } else {
          $location.path("/login")
          $scope.$apply()
        }
      } else if (path !== "/login") {
        $location.path("/login")
        $scope.$apply()
      } else {
        //dothing
      }
    }

    app.config(["$routeProvider", function ($routeProvider) {
      $routeProvider
        .when("/", {
          templateUrl: "/static/html/home.html",
          resolve: {
            authenticate,
          }
        })
        .when("/login", {
          templateUrl: "/static/html/login.html",
          resolve: {
            route
          }
        })
        .when("/register", {
          templateUrl: "/static/html/register.html",
          resolve: {
            route
          }
        })

        .when("/verify-email", {
          templateUrl: "/static/html/verify-email.html",
          resolve: {
            authenticate
          }
        })

        .when("/verify-account", {
          templateUrl: "/static/html/verify-account.html",
          resolve: {
            authenticate
          }
        })
        .when("/verify-account-process", {
          templateUrl: "/static/html/verify-account-process.html",
          resolve: {
            authenticate
          }
        })

        .when("/verify-account/lisence", {
          templateUrl: "/static/html/process-verify-account.html",
          resolve: {
            authenticate
          }
        })
        .when("/verify-account/passport", {
          templateUrl: "/static/html/process-verify-account.html",
          resolve: {
            authenticate
          }
        })
        .when("/verify-account/cmnd", {
          templateUrl: "/static/html/process-verify-account.html",
          resolve: {
            authenticate
          }
        })

        .when("/confirm-info", {
          templateUrl: "/static/html/confirm-info.html",
          resolve: {
            authenticate
          }
        })

        .when("/faceid", {
          templateUrl: "/static/html/faceid.html",
          resolve: {
            authenticate
          }
        })
        .when("/faceid-process", {
          templateUrl: "/static/html/faceid-process.html",
          resolve: {
            authenticate
          }
        })
        .when("/faceid-success", {
          templateUrl: "/static/html/faceid-success.html",
          resolve: {
            authenticate
          }
        })

        .when("/transfer-history", {
          templateUrl: "/static/html/transfer-history.html",
          resolve: {
            authenticate
          }
        })
        .when("/profile", {
          templateUrl: "/static/html/profile.html",
          resolve: {
            authenticate
          }
        })
        .when("/top-up", {
          templateUrl: "/static/html/top-up.html",
          resolve: {
            authenticate
          }
        })

        .when("/transfer", {
          templateUrl: "/static/html/transfer.html",
          resolve: {
            authenticate
          }
        })
        .when("/withdraw", {
          templateUrl: "/static/html/withdraw.html",
          resolve: {
            authenticate
          }
        })

        .when("/change-password", {
          templateUrl: "/static/html/change-password.html",
          resolve: {
            authenticate
          }
        })
        .when("/reset-password", {
          templateUrl: "/static/html/reset-password.html",
          resolve: {
            route
          }
        })

        .otherwise({
          templateUrl: "/static/html/404.html",
          resolve: {
            route
          }
        });
    }]);

    app.run(function ($rootScope, $window) {
      $rootScope.$on('$viewContentLoaded', function () {
        setTimeout(() => {
          loadingRoot.classList.add("ng-hide")
        }, 800)
      });
    });

  </script>
</body>
<style>

</style>

</html>